<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Feed Aggregator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .feed-item {
            background: #f8f9fa;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .feed-item h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .feed-item a {
            color: #667eea;
            text-decoration: none;
        }
        .feed-item a:hover {
            text-decoration: underline;
        }
        .date {
            color: #666;
            font-size: 0.9em;
        }
        .source {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            color: #495057;
            display: inline-block;
            margin-bottom: 10px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .rss-link {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            display: inline-block;
            margin: 20px 0;
        }
        .rss-link:hover {
            background: #218838;
            color: white;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Academic Publications Feed</h1>
        <p>KAIST & SNU Research Publications</p>
        <a href="#" class="rss-link" onclick="generateRSS()">ðŸ“¡ Generate RSS Feed</a>
    </div>

    <div id="loading" class="loading">Loading publications...</div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="feed-container"></div>

    <script>
        // RSS feed URLs
        const feeds = [
            {
                url: 'https://pubmed.ncbi.nlm.nih.gov/rss/search/1lGTpA7S74whuNVC_kQy0F4ncgCxeB9B9U0hbi6Wldiv2cIgV2/?limit=50&utm_campaign=pubmed-2&fc=20250822163126',
                name: 'KAIST'
            },
            {
                url: 'https://pubmed.ncbi.nlm.nih.gov/rss/search/1bo4uOs-bB_ZLOeoRMDuMyKrqOCTTJrR8i4c8aBDtpAcbJ09ch/?limit=50&utm_campaign=pubmed-2&fc=20250822163228',
                name: 'SNU'
            }
        ];

        let allItems = [];

        // CORS proxy for fetching RSS feeds
        const proxyUrl = 'https://api.allorigins.win/get?url=';

        async function fetchFeed(feed) {
            try {
                const response = await fetch(proxyUrl + encodeURIComponent(feed.url));
                const data = await response.json();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data.contents, 'text/xml');
                
                const items = xmlDoc.querySelectorAll('item');
                const feedItems = [];

                items.forEach(item => {
                    const title = item.querySelector('title')?.textContent || 'No title';
                    const link = item.querySelector('link')?.textContent || '#';
                    const description = item.querySelector('description')?.textContent || '';
                    const pubDate = item.querySelector('pubDate')?.textContent || '';
                    
                    feedItems.push({
                        title,
                        link,
                        description,
                        pubDate: new Date(pubDate),
                        source: feed.name
                    });
                });

                return feedItems;
            } catch (error) {
                console.error(`Error fetching ${feed.name} feed:`, error);
                return [];
            }
        }

        async function loadAllFeeds() {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const container = document.getElementById('feed-container');

            try {
                // Fetch all feeds
                const feedPromises = feeds.map(feed => fetchFeed(feed));
                const results = await Promise.all(feedPromises);
                
                // Combine and sort all items
                allItems = results.flat().sort((a, b) => b.pubDate - a.pubDate);

                loadingDiv.style.display = 'none';

                if (allItems.length === 0) {
                    errorDiv.textContent = 'No items found in feeds';
                    errorDiv.style.display = 'block';
                    return;
                }

                // Display items
                container.innerHTML = allItems.map(item => `
                    <div class="feed-item">
                        <div class="source">${item.source}</div>
                        <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                        <div class="date">${item.pubDate.toLocaleDateString()}</div>
                        <p>${item.description.substring(0, 300)}${item.description.length > 300 ? '...' : ''}</p>
                    </div>
                `).join('');

            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.textContent = 'Error loading feeds: ' + error.message;
                errorDiv.style.display = 'block';
            }
        }

        function generateRSS() {
            const rssContent = `<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
    <channel>
        <title>KAIST & SNU Publications</title>
        <description>Combined academic publications from KAIST and SNU</description>
        <link>${window.location.href}</link>
        <lastBuildDate>${new Date().toUTCString()}</lastBuildDate>
        
        ${allItems.map(item => `
        <item>
            <title><![CDATA[${item.title} (${item.source})]]></title>
            <link>${item.link}</link>
            <description><![CDATA[${item.description}]]></description>
            <pubDate>${item.pubDate.toUTCString()}</pubDate>
            <guid>${item.link}</guid>
        </item>`).join('')}
    </channel>
</rss>`;

            // Create and download RSS file
            const blob = new Blob([rssContent], { type: 'application/rss+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'combined-feed.xml';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load feeds when page loads
        window.addEventListener('load', loadAllFeeds);
    </script>
</body>
</html>
